/*! For license information please see renderer.bundle.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n(){"use strict";n=function(){return r};var t,r={},a=Object.prototype,o=a.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",d=c.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(t){u=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var a=t&&t.prototype instanceof b?t:b,o=Object.create(a.prototype),c=new q(r||[]);return i(o,"_invoke",{value:I(e,n,c)}),o}function m(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}r.wrap=p;var f="suspendedStart",g="suspendedYield",y="executing",h="completed",v={};function b(){}function x(){}function E(){}var k={};u(k,l,(function(){return this}));var w=Object.getPrototypeOf,C=w&&w(w(_([])));C&&C!==a&&o.call(C,l)&&(k=C);var L=E.prototype=b.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function N(t,n){function r(a,i,c,l){var s=m(t[a],t,i);if("throw"!==s.type){var d=s.arg,u=d.value;return u&&"object"==e(u)&&o.call(u,"__await")?n.resolve(u.__await).then((function(e){r("next",e,c,l)}),(function(e){r("throw",e,c,l)})):n.resolve(u).then((function(e){d.value=e,c(d)}),(function(e){return r("throw",e,c,l)}))}l(s.arg)}var a;i(this,"_invoke",{value:function(e,t){function o(){return new n((function(n,a){r(e,t,n,a)}))}return a=a?a.then(o,o):o()}})}function I(e,n,r){var a=f;return function(o,i){if(a===y)throw Error("Generator is already running");if(a===h){if("throw"===o)throw i;return{value:t,done:!0}}for(r.method=o,r.arg=i;;){var c=r.delegate;if(c){var l=A(c,r);if(l){if(l===v)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===f)throw a=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=y;var s=m(e,n,r);if("normal"===s.type){if(a=r.done?h:g,s.arg===v)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(a=h,r.method="throw",r.arg=s.arg)}}}function A(e,n){var r=n.method,a=e.iterator[r];if(a===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,A(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=m(a,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var i=o.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function F(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function q(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(F,this),this.reset(!0)}function _(n){if(n||""===n){var r=n[l];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var a=-1,i=function e(){for(;++a<n.length;)if(o.call(n,a))return e.value=n[a],e.done=!1,e;return e.value=t,e.done=!0,e};return i.next=i}}throw new TypeError(e(n)+" is not iterable")}return x.prototype=E,i(L,"constructor",{value:E,configurable:!0}),i(E,"constructor",{value:x,configurable:!0}),x.displayName=u(E,d,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,u(e,d,"GeneratorFunction")),e.prototype=Object.create(L),e},r.awrap=function(e){return{__await:e}},S(N.prototype),u(N.prototype,s,(function(){return this})),r.AsyncIterator=N,r.async=function(e,t,n,a,o){void 0===o&&(o=Promise);var i=new N(p(e,t,n,a),o);return r.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},S(L),u(L,d,"Generator"),u(L,l,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},r.values=_,q.prototype={constructor:q,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(B),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,a){return c.type="throw",c.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],c=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var l=o.call(i,"catchLoc"),s=o.call(i,"finallyLoc");if(l&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;B(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:_(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},r}function r(e,t,n,r,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,a)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var i=e.apply(t,n);function c(e){r(i,a,o,c,l,"next",e)}function l(e){r(i,a,o,c,l,"throw",e)}c(void 0)}))}}var o=null,i=0;function c(){o=null,i=0}function l(){return s.apply(this,arguments)}function s(){return(s=a(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Date.now(),o&&!(t-i>3e4)){e.next=21;break}return e.prev=2,console.log("Cache miss, fetching fresh stocks data..."),e.next=6,window.api.getStocksWithLatest();case 6:if(o=e.sent,console.log("Received stocks data from API:",o),o&&Array.isArray(o)){e.next=11;break}throw console.error("Invalid stocks data format:",o),new Error("Invalid stocks data format");case 11:0===o.length?console.log("No stocks data received from API"):(console.log("Received",o.length,"stocks from API"),o.forEach((function(e){console.log("Stock:",{id:e.id,name:e.name,category:e.category_name,percentage:e.percentage})}))),i=t,e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(2),console.error("Failed to fetch stocks:",e.t0),new Error("Failed to fetch stocks data");case 19:e.next=22;break;case 21:console.log("Using cached stocks data:",o);case 22:return e.abrupt("return",o);case 23:case"end":return e.stop()}}),e,null,[[2,15]])})))).apply(this,arguments)}document.addEventListener("DOMContentLoaded",(function(){console.log("DOM Content Loaded, initializing app..."),document.querySelectorAll(".tab").forEach((function(e){e.addEventListener("click",(function(){document.querySelectorAll(".tab").forEach((function(e){return e.classList.remove("active")})),document.querySelectorAll(".tab-content").forEach((function(e){return e.classList.remove("active")})),e.classList.add("active");var t=e.getAttribute("data-tab");document.getElementById(t).classList.add("active"),"home"===t?b():"analytics"===t?function(){E.apply(this,arguments)}():"settings"===t&&k()}))})),b();var e=document.getElementById("modal"),r=document.getElementById("stock-form"),o=document.getElementById("add-stock-btn"),i=document.getElementById("modal-close"),s=null;o.addEventListener("click",(function(){return f()})),i.addEventListener("click",(function(){return e.style.display="none"})),document.getElementById("add-category-btn").addEventListener("click",y),r.addEventListener("submit",(function(e){return v.apply(this,arguments)}));var d,u=document.querySelector(".toggle-container"),p=u.querySelectorAll(".toggle-option");function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"basic";document.getElementById("basic-fields").style.display="basic"===e?"block":"none",document.getElementById("exact-fields").style.display="exact"===e?"block":"none"}function f(){return g.apply(this,arguments)}function g(){return g=a(n().mark((function t(){var r,o,i,c,d,u,p,f,g,y,h,v=arguments;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=(r=v.length>0&&void 0!==v[0]?v[0]:null)?r.id:null,document.getElementById("modal-title").textContent=r?"Edit Item":"Add Item",t.next=5,window.api.getCategories();case 5:o=t.sent,i=document.getElementById("stock-category"),c=o.find((function(e){return"Uncategorized"===e.name})),d=o.filter((function(e){return"Uncategorized"!==e.name})),i.innerHTML='<option value="'.concat(c?c.id:"",'">Uncategorized</option>')+d.map((function(e){return'<option value="'.concat(e.id,'">').concat(e.name,"</option>")})).join(""),u=document.getElementById("stock-name"),(p=u.parentElement).style.width="100%",p.style.boxSizing="border-box",u.style.width="100%",u.style.boxSizing="border-box",u.style.padding="12px 16px",u.style.border="1px solid #E5E5EA",u.style.borderRadius="14px",u.style.background="#f5f5f7",u.style.fontSize="15px",u.style.color="#1d1d1f",(f=p.querySelector(".error-message"))||((f=document.createElement("div")).className="error-message",f.style.fontSize="13px",f.style.color="#FF3B30",f.style.marginTop="6px",p.appendChild(f)),u.style.transition="border-color 0.2s ease",u.style.border="1px solid #E5E5EA",u.style.borderRadius="8px",g=u.cloneNode(!0),u.parentNode.replaceChild(g,u),g.addEventListener("input",a(n().mark((function e(){var t,r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=g.value.trim(),r=document.querySelector('button[type="submit"]'),!t){e.next=10;break}return e.next=5,l();case 5:e.sent.find((function(e){return e.name.toLowerCase()===t.toLowerCase()&&(!s||e.id!==s)}))?(g.style.borderColor="#FF3B30",r.disabled=!0,r.style.opacity="0.5",f.textContent="Already exists. Choose another name."):(g.style.borderColor="#E5E5EA",r.disabled=!1,r.style.opacity="1",f.textContent=""),e.next=14;break;case 10:g.style.borderColor="#E5E5EA",r.disabled=!0,r.style.opacity="0.5",f.textContent="";case 14:case"end":return e.stop()}}),e)})))),r?(g.value=r.name,(y=document.querySelector(".toggle-container")).querySelectorAll(".toggle-option").forEach((function(e){e.dataset.value===r.type?e.classList.add("active"):e.classList.remove("active")})),y.dataset.active=r.type,m(r.type),"basic"===r.type?document.getElementById("basic-level").value=r.percentage:(document.getElementById("exact-current").value=r.percentage/100*r.full_value,document.getElementById("exact-full").value=r.full_value,document.getElementById("exact-unit").value=r.unit||""),i.value=r.category_id):(document.getElementById("stock-name").value="",(h=document.querySelector(".toggle-container")).querySelectorAll(".toggle-option").forEach((function(e){"basic"===e.dataset.value?e.classList.add("active"):e.classList.remove("active")})),h.dataset.active="basic",document.getElementById("basic-level").value="100",document.getElementById("exact-current").value="",document.getElementById("exact-full").value="",document.getElementById("exact-unit").value="",m("basic")),e.style.display="block";case 32:case"end":return t.stop()}}),t)}))),g.apply(this,arguments)}function y(){return h.apply(this,arguments)}function h(){return(h=a(n().mark((function e(){var t,r,o,i,c,l,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=document.getElementById("stock-category"),r=t.parentElement,(o=document.createElement("div")).className="category-add",o.style.width="100%",o.style.maxWidth="100%",o.style.position="relative",o.style.display="flex",o.style.flexDirection="column",o.style.gap="6px",(i=document.createElement("div")).style.width="100%",i.style.position="relative",i.style.display="flex",i.style.alignItems="center",(c=document.createElement("input")).type="text",c.placeholder="Category name",c.style.width="100%",c.style.boxSizing="border-box",c.style.paddingRight="80px",c.style.transition="border-color 0.2s ease",c.style.border="1px solid #E5E5EA",c.style.borderRadius="8px",(l=document.createElement("button")).className="keep-button",l.textContent="Keep",l.disabled=!1,l.style.position="absolute",l.style.right="0",l.style.marginRight="8px",(s=document.createElement("div")).className="error",s.style.fontSize="13px",s.style.color="#FF3B30",s.style.width="100%",s.style.marginTop="0",i.appendChild(c),i.appendChild(l),o.appendChild(i),o.appendChild(s),r.style.display="none",r.parentElement.appendChild(o),c.addEventListener("input",a(n().mark((function e(){var t;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=c.value.trim())){e.next=9;break}return e.next=4,window.api.getCategories();case 4:e.sent.find((function(e){return e.name.toLowerCase()===t.toLowerCase()}))?(c.style.borderColor="#FF3B30",c.style.borderWidth="1px",l.style.opacity="0.5",l.style.pointerEvents="none",l.disabled=!0,s.textContent="Already exists. Choose another name or select from the dropdown."):(c.style.borderColor="#E5E5EA",c.style.borderWidth="1px",l.style.opacity="1",l.style.pointerEvents="auto",l.disabled=!1,l.classList.add("visible"),s.textContent=""),e.next=13;break;case 9:c.style.borderColor="#E5E5EA",c.style.borderWidth="1px",l.classList.remove("visible"),s.textContent="";case 13:case"end":return e.stop()}}),e)})))),l.onclick=a(n().mark((function e(){var a,i,l;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=c.value.trim())){e.next=19;break}return e.prev=2,e.next=5,window.api.addCategory(a);case 5:i=e.sent,(l=document.createElement("option")).value=i,l.textContent=a,t.appendChild(l),t.value=i,o.remove(),r.style.display="",e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),console.error("Failed to add category:",e.t0),s.textContent="Failed to add category";case 19:case"end":return e.stop()}}),e,null,[[2,15]])}))),c.focus(),c.addEventListener("keydown",(function(e){"Escape"===e.key&&(o.remove(),r.style.display="")}));case 47:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(){return(v=a(n().mark((function t(r){var a,o,i,d,u,p,m,g,y,h,v,x,E,w,C,L,S,N,I;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.preventDefault(),(a=document.getElementById("error-msg")).textContent="",o=r.target.querySelector('button[type="submit"]'),t.prev=4,i=document.getElementById("stock-name").value.trim(),d=document.getElementById("stock-category").value,u=document.querySelector(".toggle-container").dataset.active,m=null,g=null,console.log("Form data:",{name:i,category_id:d,type:u}),i){t.next=12;break}throw new Error("Name is required");case 12:if(d){t.next=20;break}return t.next=15,window.api.getCategories();case 15:if(y=t.sent,h=y.find((function(e){return"Uncategorized"===e.name}))){t.next=19;break}throw new Error("Uncategorized category not found");case 19:d=h.id;case 20:return t.next=22,l();case 22:if(v=t.sent,!(x=v.find((function(e){return e.name.toLowerCase()===i.toLowerCase()&&(!s||e.id!==s)})))){t.next=41;break}if(!confirm('An item named "'.concat(x.name,'" already exists. Would you like to edit it instead?'))){t.next=40;break}return e.style.display="none",t.next=30,l();case 30:if(E=t.sent,!(w=E.find((function(e){return e.id===x.id})))){t.next=36;break}f(w),t.next=37;break;case 36:throw new Error("Failed to load existing item data");case 37:return t.abrupt("return");case 40:throw new Error("Please use a different name for your item");case 41:if("basic"!==u){t.next=56;break}C=document.getElementById("basic-level").value,console.log("Basic level selected:",C),t.t0=C,t.next="full"===t.t0?47:"half"===t.t0?49:"refill"===t.t0?51:53;break;case 47:return p=100,t.abrupt("break",54);case 49:return p=50,t.abrupt("break",54);case 51:return p=10,t.abrupt("break",54);case 53:throw new Error("Invalid stock level");case 54:t.next=65;break;case 56:if(L=parseFloat(document.getElementById("exact-current").value),m=parseFloat(document.getElementById("exact-full").value),g=document.getElementById("exact-unit").value.trim(),console.log("Exact measurements:",{current:L,full_value:m,unit:g}),!(isNaN(L)||isNaN(m)||m<=0)){t.next=62;break}throw new Error("Current amount and full value must be valid numbers greater than 0");case 62:if(!(L>m)){t.next=64;break}throw new Error("Current amount cannot be greater than full value");case 64:p=L/m*100;case 65:if(S={name:i,category_id:d,type:u,full_value:m,unit:g,percentage:p},console.log("Saving stock:",S),t.prev=67,!s){t.next=76;break}return console.log("Updating existing stock:",s),S.id=s,t.next=73,window.api.updateStock(S);case 73:N=t.sent,t.next=80;break;case 76:return console.log("Adding new stock"),t.next=79,window.api.addStock(S);case 79:N=t.sent;case 80:if(console.log("Save operation result:",N),o.classList.add("success"),console.log("Invalidating cache"),c(),I=document.querySelector(".tab.active").getAttribute("data-tab"),console.log("Current tab:",I),console.log("Reloading data for current tab"),"home"!==I){t.next=92;break}return t.next=90,b();case 90:t.next=95;break;case 92:if("settings"!==I){t.next=95;break}return t.next=95,k();case 95:setTimeout((function(){o.classList.remove("success"),e.style.display="none"}),1e3),t.next=102;break;case 98:throw t.prev=98,t.t1=t.catch(67),console.error("Database operation failed:",t.t1),new Error("Failed to save to database. Please try again.");case 102:t.next=108;break;case 104:t.prev=104,t.t2=t.catch(4),console.error("Form submission failed:",t.t2),a.textContent=t.t2.message||"Failed to save stock";case 108:case"end":return t.stop()}}),t,null,[[4,104],[67,98]])})))).apply(this,arguments)}function b(){return x.apply(this,arguments)}function x(){return(x=a(n().mark((function e(){var t,r,a,o,i;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("home"),e.prev=1,console.log("Starting loadHome"),t.innerHTML='<div class="loading">Loading...</div>',console.log("Invalidating cache before loading home"),c(),console.log("Fetching stocks data"),e.next=9,l();case 9:if(r=e.sent,console.log("Received stocks in loadHome:",r),r&&Array.isArray(r)){e.next=14;break}throw console.error("Invalid stocks data in loadHome:",r),new Error("Failed to load stocks data");case 14:if(0!==r.length){e.next=18;break}return console.log("No stocks found in loadHome"),t.innerHTML='<div class="empty-state">No items yet. Click the + button to add some!</div>',e.abrupt("return");case 18:t.textContent="",a=r.filter((function(e){return e.percentage<50})).sort((function(e,t){return e.percentage-t.percentage})),o=r.filter((function(e){return e.percentage>=50&&e.percentage<90})).sort((function(e,t){return e.percentage-t.percentage})),i=r.filter((function(e){return e.percentage>=90})).sort((function(e,t){return e.percentage-t.percentage})),[{title:"Needs Refill",items:a,defaultOpen:!0},{title:"Getting Low",items:o,defaultOpen:!0},{title:"Well Stocked",items:i,defaultOpen:!1}].forEach((function(e,n){if(0!==e.items.length){var r=document.createElement("div");r.className="stock-category-section";var a=document.createElement("div");a.className="category-header";var o=document.createElement("h2");o.innerHTML='<span class="collapse-indicator">'.concat(e.defaultOpen?"▼":"▶","</span> ").concat(e.title," (").concat(e.items.length,")"),a.appendChild(o);var i=document.createElement("div");i.className="bento-grid",e.defaultOpen||i.classList.add("collapsed"),a.addEventListener("click",(function(){var e=i.classList.contains("collapsed");document.querySelectorAll(".stock-category-section").forEach((function(e){e!==r&&(e.querySelector(".bento-grid").classList.add("collapsed"),e.querySelector(".collapse-indicator").textContent="▶")})),i.classList.toggle("collapsed",!e),a.querySelector(".collapse-indicator").textContent=e?"▼":"▶"})),e.items.forEach((function(e){console.log("Creating bento item:",e);var t=document.createElement("div");t.className="bento-item",e.percentage>=90?t.classList.add("full"):e.percentage>=50?t.classList.add("half"):t.classList.add("refill");var n=document.createElement("h3");n.textContent=e.name;var r=document.createElement("span");r.className="category-label",r.textContent=e.category_name||"Uncategorized";var a=document.createElement("div");a.className="liquid-gauge";var o=document.createElement("div");o.className="liquid-fill",o.style.width="".concat(e.percentage,"%"),e.percentage>=90?o.classList.add("full"):e.percentage>=50?o.classList.add("half"):o.classList.add("refill"),a.appendChild(o),t.appendChild(n),t.appendChild(r),t.appendChild(a),t.onclick=function(){return editStock(e.id)},i.appendChild(t)})),r.appendChild(a),r.appendChild(i),t.appendChild(r)}})),console.log("Home tab rendering complete"),e.next=31;break;case 27:e.prev=27,e.t0=e.catch(1),console.error("Failed to load home:",e.t0),t.innerHTML='<div class="error">Failed to load data. Please try again.</div>';case 31:case"end":return e.stop()}}),e,null,[[1,27]])})))).apply(this,arguments)}function E(){return(E=a(n().mark((function e(){var r,a,o,i,c;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.api.getHistory();case 3:r=e.sent,d&&d.destroy(),a={},r.forEach((function(e){if(e.stock_name&&e.timestamp){a[e.stock_name]||(a[e.stock_name]=[]);var t=moment(e.timestamp).toDate();isNaN(t)||a[e.stock_name].push({x:t,y:parseFloat(e.percentage)||0})}else console.warn("Invalid history entry:",e)})),o=["#007AFF","#34C759","#FF9500","#FF2D55","#5856D6","#FF3B30"],i=Object.entries(a).map((function(e,n){var r,a,i=(a=2,function(e){if(Array.isArray(e))return e}(r=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,c=[],l=!0,s=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(c.push(r.value),c.length!==t);l=!0);}catch(e){s=!0,a=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw a}}return c}}(r,a)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(r,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());return{label:i[0],data:i[1].sort((function(e,t){return e.x-t.x})),borderColor:o[n%o.length],backgroundColor:o[n%o.length]+"20",fill:!0,tension:.4,pointRadius:3,pointHoverRadius:5}})),c=document.getElementById("analytics-chart").getContext("2d"),d=new Chart(c,{type:"line",data:{datasets:i},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},plugins:{title:{display:!0,text:"Item Level History",font:{size:16,weight:"bold"}},legend:{position:"top",labels:{usePointStyle:!0,padding:15}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#1d1d1f",bodyColor:"#1d1d1f",borderColor:"#e5e5e7",borderWidth:1,padding:10,displayColors:!0,callbacks:{title:function(e){return moment(e[0].raw.x).format("MMM D, YYYY")},label:function(e){return"".concat(e.dataset.label,": ").concat(Math.round(e.raw.y),"%")}}}},scales:{x:{type:"time",time:{unit:"day",displayFormats:{day:"MMM D",week:"MMM D",month:"MMM YYYY"},tooltipFormat:"MMM D, YYYY"},title:{display:!0,text:"Date"},grid:{display:!1}},y:{beginAtZero:!0,max:100,title:{display:!0,text:"Stock Level (%)"},grid:{color:"#e5e5e7"}}}}}),document.querySelectorAll(".time-toggle").forEach((function(e){return e.classList.remove("active")})),document.querySelector('.time-toggle[data-unit="day"]').classList.add("active"),document.querySelectorAll(".time-toggle").forEach((function(e){e.onclick=function(){document.querySelectorAll(".time-toggle").forEach((function(e){return e.classList.remove("active")})),e.classList.add("active"),d&&(d.options.scales.x.time.unit=e.dataset.unit,d.update())}})),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("Failed to load analytics:",e.t0),document.getElementById("analytics").innerHTML='<div class="error">Failed to load analytics data. Please try again.</div>';case 20:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}function k(){return w.apply(this,arguments)}function w(){return w=a(n().mark((function e(){var t,r,o,i,s,d,u,p,m,g,h,v,b,x,E,k,w,C,L,S,N;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("settings"),e.prev=1,console.log("Loading settings tab..."),t){e.next=6;break}return console.error("Settings element not found"),e.abrupt("return");case 6:return t.innerHTML='<div class="loading">Loading...</div>',console.log("Invalidating cache and fetching fresh data..."),c(),console.log("Fetching stocks..."),e.next=12,l();case 12:return r=e.sent,console.log("Fetched stocks:",r),console.log("Fetching categories..."),e.next=17,window.api.getCategories();case 17:o=e.sent,console.log("Fetched categories:",o),console.log("Loaded data for settings:",{stocks:r,categories:o}),t.textContent="",(i=document.createElement("div")).className="settings-container",t.appendChild(i),s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=document.createElement("div");r.className="settings-section";var a=document.createElement("div");a.className="settings-header";var o=document.createElement("h2");o.innerHTML='<span class="collapse-indicator">▼</span> '.concat(e),a.appendChild(o),n&&a.appendChild(n);var i=document.createElement("div");return i.className="settings-list",a.addEventListener("click",(function(e){if("BUTTON"!==e.target.tagName){var t=a.querySelector(".collapse-indicator"),n=i.classList.contains("collapsed");document.querySelectorAll(".settings-section").forEach((function(e){e!==r&&(e.querySelector(".settings-list").classList.add("collapsed"),e.querySelector(".collapse-indicator").textContent="▶",e.querySelector(".settings-header").classList.add("collapsed"),e.classList.add("collapsed"))})),i.classList.toggle("collapsed",!n),t.textContent=n?"▼":"▶",a.classList.toggle("collapsed",!n),r.classList.toggle("collapsed",!n)}})),r.appendChild(a),r.appendChild(i),i.appendChild(t),r},(d=document.createElement("button")).textContent="Add Category",d.onclick=function(){console.log("Add category button clicked"),y()},(u=document.createElement("div")).className="settings-list-content",(p=o.filter((function(e){return"Uncategorized"!==e.name})))&&0!==p.length?p.forEach((function(e){var t=document.createElement("div");t.className="settings-item";var r=document.createElement("span");r.textContent=e.name;var o=document.createElement("div");o.className="item-controls";var i=document.createElement("button");i.textContent="Delete",i.className="delete-btn",i.onclick=function(){var t=a(n().mark((function t(r){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.stopPropagation(),t.next=3,deleteCategory(e.id);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),o.appendChild(i),t.appendChild(r),t.appendChild(o),u.appendChild(t)})):((m=document.createElement("div")).className="empty-state",m.textContent="No categories yet. Add your first category!",u.appendChild(m)),i.appendChild(s("Categories",u,d)),(g=document.createElement("button")).textContent="Add Item",g.onclick=function(){console.log("Add item button clicked"),f()},h=function(e,t){return e.percentage-t.percentage},(v=document.createElement("div")).className="settings-list-content",(b=r.filter((function(e){return"Uncategorized"!==e.category_name})))&&0!==b.length?b.sort(h).forEach((function(e){var t=document.createElement("div");t.className="settings-item",e.percentage>=90?t.classList.add("full"):e.percentage>=50?t.classList.add("half"):t.classList.add("refill");var r=document.createElement("div");r.className="item-info";var o=document.createElement("span");o.className="item-name",o.textContent=e.name;var i=document.createElement("span");i.className="item-details",i.textContent=e.category_name,r.appendChild(o),r.appendChild(i);var c=document.createElement("div");c.className="item-controls";var l=document.createElement("button");l.textContent=">",l.className="edit-btn",l.onclick=function(t){t.stopPropagation(),editStock(e.id)};var s=document.createElement("button");s.textContent="Delete",s.className="delete-btn",s.onclick=function(){var t=a(n().mark((function t(r){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.stopPropagation(),t.next=3,deleteStock(e.id);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c.appendChild(l),c.appendChild(s),t.appendChild(r),t.appendChild(c),t.onclick=function(){return editStock(e.id)},v.appendChild(t)})):((x=document.createElement("div")).className="empty-state",x.textContent="No items yet. Click the + button to add some!",v.appendChild(x)),i.appendChild(s("Items",v,g)),(E=o.find((function(e){return"Uncategorized"===e.name})))&&((k=document.createElement("div")).className="settings-list-content",0===(w=r.filter((function(e){return e.category_id===E.id}))).length?((C=document.createElement("div")).className="empty-state",C.textContent="No uncategorized items.",k.appendChild(C)):w.sort(h).forEach((function(e){var t=document.createElement("div");t.className="settings-item",e.percentage>=90?t.classList.add("full"):e.percentage>=50?t.classList.add("half"):t.classList.add("refill");var n=document.createElement("div");n.className="item-info";var r=document.createElement("span");r.className="item-name",r.textContent=e.name;var a=document.createElement("span");a.className="item-details",a.textContent=e.category_name||"Uncategorized",n.appendChild(r),n.appendChild(a);var o=document.createElement("div");o.className="item-controls";var i=document.createElement("button");i.textContent=">",i.className="edit-btn",i.onclick=function(t){t.stopPropagation(),editStock(e.id)},o.appendChild(i),t.appendChild(n),t.appendChild(o),t.onclick=function(){return editStock(e.id)},k.appendChild(t)})),i.appendChild(s("Uncategorized Items",k))),(L=i.querySelector(".settings-section"))&&(S=L.querySelector(".settings-list"),N=L.querySelector(".collapse-indicator"),S.classList.remove("collapsed"),N.textContent="▼"),console.log("Settings tab rendering complete"),e.next=54;break;case 50:e.prev=50,e.t0=e.catch(1),console.error("Failed to load settings:",e.t0),t&&(t.innerHTML='<div class="error">Failed to load settings. Please try again.</div>');case 54:case"end":return e.stop()}}),e,null,[[1,50]])}))),w.apply(this,arguments)}p.forEach((function(e){e.addEventListener("click",(function(){var t=e.dataset.value;p.forEach((function(e){return e.classList.remove("active")})),e.classList.add("active"),u.dataset.active=t,m(t)}))})),document.querySelectorAll(".time-toggle").forEach((function(e){e.addEventListener("click",(function(){var t;null===(t=document.querySelector(".time-toggle.active"))||void 0===t||t.classList.remove("active"),e.classList.add("active"),d&&(d.options.scales.x.time.unit=e.dataset.unit,d.update())}))})),window.editStock=function(){var e=a(n().mark((function e(t){return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.api.getStocksWithLatest();case 2:f(e.sent.find((function(e){return e.id===t})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),window.deleteStock=function(){var e=a(n().mark((function e(t){var r;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("Delete this stock?")){e.next=14;break}return e.prev=1,e.next=4,window.api.deleteStock(t);case 4:return c(),r=document.querySelector(".tab.active").getAttribute("data-tab"),e.next=8,Promise.all(["home"===r?b():Promise.resolve(),"settings"===r?k():Promise.resolve()]);case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("Failed to delete stock:",e.t0),alert("Failed to delete stock. Please try again.");case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}(),window.deleteCategory=function(){var e=a(n().mark((function e(t){var r,a,o,i,s;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.api.getCategories();case 3:return r=e.sent,a=r.find((function(e){return e.id===t})),e.next=7,l();case 7:if(o=e.sent,!((i=o.filter((function(e){return e.category_id===t}))).length>0)){e.next=15;break}if(confirm("This category contains ".concat(i.length," item(s). ")+'If you delete this category, all items will be moved to "Uncategorized". \n\nDo you want to proceed anyway?')){e.next=13;break}return e.abrupt("return");case 13:e.next=18;break;case 15:if(confirm('Delete category "'.concat(a.name,'"?'))){e.next=18;break}return e.abrupt("return");case 18:return e.next=20,window.api.deleteCategory(t);case 20:return c(),s=document.querySelector(".tab.active").getAttribute("data-tab"),e.next=24,Promise.all(["home"===s?b():Promise.resolve(),"settings"===s?k():Promise.resolve()]);case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(0),console.error("Failed to delete category:",e.t0),"Cannot delete the Uncategorized category"===e.t0.message?alert("The Uncategorized category cannot be deleted."):alert(e.t0.message||"Failed to delete category. Please try again.");case 30:case"end":return e.stop()}}),e,null,[[0,26]])})));return function(t){return e.apply(this,arguments)}}()}))})();